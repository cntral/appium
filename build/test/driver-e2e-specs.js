"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

require("source-map-support/register");

var _lodash = _interopRequireDefault(require("lodash"));

var _bluebird = _interopRequireDefault(require("bluebird"));

var _chai = _interopRequireDefault(require("chai"));

var _chaiAsPromised = _interopRequireDefault(require("chai-as-promised"));

var _wd = _interopRequireDefault(require("wd"));

var _axios = _interopRequireDefault(require("axios"));

var _main = require("../lib/main");

var _helpers = require("./helpers");

var _appiumBaseDriver = require("appium-base-driver");

var _appiumFakeDriver = require("appium-fake-driver");

var _sinon = _interopRequireDefault(require("sinon"));

_chai.default.use(_chaiAsPromised.default);

const should = _chai.default.should();

const shouldStartServer = process.env.USE_RUNNING_SERVER !== '0';
const caps = {
  platformName: 'Fake',
  deviceName: 'Fake',
  app: _helpers.TEST_FAKE_APP
};
describe('FakeDriver - via HTTP', function () {
  let server = null;
  const baseUrl = `http://${_helpers.TEST_HOST}:${_helpers.TEST_PORT}/wd/hub/session`;
  before(async function () {
    if (shouldStartServer) {
      let args = {
        port: _helpers.TEST_PORT,
        host: _helpers.TEST_HOST
      };
      server = await (0, _main.main)(args);
    }
  });
  after(async function () {
    if (server) {
      await server.close();
    }
  });
  describe('session handling', function () {
    it('should start and stop a session', async function () {
      let driver = _wd.default.promiseChainRemote(_helpers.TEST_HOST, _helpers.TEST_PORT);

      let [sessionId] = await driver.init(caps);
      should.exist(sessionId);
      sessionId.should.be.a('string');
      await driver.quit();
      await driver.title().should.eventually.be.rejectedWith(/terminated/);
    });
    it('should be able to run two FakeDriver sessions simultaneously', async function () {
      let driver1 = _wd.default.promiseChainRemote(_helpers.TEST_HOST, _helpers.TEST_PORT);

      let [sessionId1] = await driver1.init(caps);
      should.exist(sessionId1);
      sessionId1.should.be.a('string');

      let driver2 = _wd.default.promiseChainRemote(_helpers.TEST_HOST, _helpers.TEST_PORT);

      let [sessionId2] = await driver2.init(caps);
      should.exist(sessionId2);
      sessionId2.should.be.a('string');
      sessionId1.should.not.equal(sessionId2);
      await driver1.quit();
      await driver2.quit();
    });
    it('should not be able to run two FakeDriver sessions simultaneously when one is unique', async function () {
      let uniqueCaps = _lodash.default.clone(caps);

      uniqueCaps.uniqueApp = true;

      let driver1 = _wd.default.promiseChainRemote(_helpers.TEST_HOST, _helpers.TEST_PORT);

      let [sessionId1] = await driver1.init(uniqueCaps);
      should.exist(sessionId1);
      sessionId1.should.be.a('string');

      let driver2 = _wd.default.promiseChainRemote(_helpers.TEST_HOST, _helpers.TEST_PORT);

      await driver2.init(caps).should.eventually.be.rejected;
      await driver1.quit();
    });
    it('should use the newCommandTimeout of the inner Driver on session creation', async function () {
      let driver = _wd.default.promiseChainRemote(_helpers.TEST_HOST, _helpers.TEST_PORT);

      let localCaps = Object.assign({
        newCommandTimeout: 0.25
      }, caps);
      let [sessionId] = await driver.init(localCaps);
      should.exist(sessionId);
      await _bluebird.default.delay(250);
      await driver.source().should.eventually.be.rejectedWith(/terminated/);
    });
    it('should accept valid W3C capabilities and start a W3C session', async function () {
      const w3cCaps = {
        capabilities: {
          alwaysMatch: {
            platformName: 'Fake'
          },
          firstMatch: [{
            'appium:deviceName': 'Fake',
            'appium:app': _helpers.TEST_FAKE_APP
          }]
        }
      };
      const {
        status,
        value,
        sessionId
      } = (await _axios.default.post(baseUrl, w3cCaps)).data;
      should.not.exist(status);
      should.not.exist(sessionId);
      value.sessionId.should.be.a.string;
      value.should.exist;
      value.capabilities.should.deep.equal({
        platformName: 'Fake',
        deviceName: 'Fake',
        app: _helpers.TEST_FAKE_APP
      });
      const {
        status: screenshotStatus,
        value: screenshotValue
      } = (await (0, _axios.default)({
        url: `${baseUrl}/${value.sessionId}/screenshot`
      })).data;
      should.not.exist(screenshotStatus);
      screenshotValue.should.equal('hahahanotreallyascreenshot');
      await _axios.default.post(`${baseUrl}/${value.sessionId}/execute/async`, {
        script: '',
        args: ['a']
      }).should.eventually.be.rejectedWith(/405/);
      await _axios.default.delete(`${baseUrl}/${value.sessionId}`);
    });
    it('should reject invalid W3C capabilities and respond with a 400 Bad Parameters error', async function () {
      const badW3Ccaps = {
        capabilities: {
          alwaysMatch: {},
          firstMatch: [{
            'appium:deviceName': 'Fake',
            'appium:app': _helpers.TEST_FAKE_APP
          }]
        }
      };
      await _axios.default.post(baseUrl, badW3Ccaps).should.eventually.be.rejectedWith(/400/);
    });
    it('should accept a combo of W3C and JSONWP capabilities but default to W3C', async function () {
      const combinedCaps = {
        'desiredCapabilities': { ...caps
        },
        'capabilities': {
          'alwaysMatch': { ...caps
          },
          'firstMatch': [{
            w3cParam: 'w3cParam'
          }]
        }
      };
      const {
        status,
        value,
        sessionId
      } = (await _axios.default.post(baseUrl, combinedCaps)).data;
      should.not.exist(status);
      should.not.exist(sessionId);
      value.sessionId.should.exist;
      value.capabilities.should.deep.equal({ ...caps,
        w3cParam: 'w3cParam'
      });
      await _axios.default.delete(`${baseUrl}/${value.sessionId}`);
    });
    it('should accept a combo of W3C and JSONWP and if JSONWP has extraneous keys, they should be merged into W3C capabilities', async function () {
      const combinedCaps = {
        'desiredCapabilities': { ...caps,
          automationName: 'Fake',
          anotherParam: 'Hello'
        },
        'capabilities': {
          'alwaysMatch': { ...caps
          },
          'firstMatch': [{
            w3cParam: 'w3cParam'
          }]
        }
      };
      const {
        sessionId,
        status,
        value
      } = (await _axios.default.post(baseUrl, combinedCaps)).data;
      should.not.exist(sessionId);
      should.not.exist(status);
      value.sessionId.should.exist;
      value.capabilities.should.deep.equal({ ...caps,
        automationName: 'Fake',
        anotherParam: 'Hello',
        w3cParam: 'w3cParam'
      });
      await _axios.default.delete(`${baseUrl}/${value.sessionId}`);
    });
    it('should reject bad W3C capabilities with a BadParametersError (400)', async function () {
      const w3cCaps = {
        capabilities: {
          alwaysMatch: { ...caps,
            automationName: 'BadAutomationName'
          }
        }
      };
      await _axios.default.post(baseUrl, w3cCaps).should.eventually.be.rejectedWith(/400/);
    });
    it('should accept capabilities that are provided in the firstMatch array', async function () {
      const w3cCaps = {
        capabilities: {
          alwaysMatch: {},
          firstMatch: [{}, { ...caps
          }]
        }
      };
      const {
        value,
        sessionId,
        status
      } = (await _axios.default.post(baseUrl, w3cCaps)).data;
      should.not.exist(status);
      should.not.exist(sessionId);
      value.capabilities.should.deep.equal(caps);
      await _axios.default.delete(`${baseUrl}/${value.sessionId}`);
    });
    it('should fall back to MJSONWP if w3c caps are invalid', async function () {
      const combinedCaps = {
        desiredCapabilities: { ...caps
        },
        capabilities: {
          alwaysMatch: {},
          firstMatch: [{}, { ...caps,
            platformName: null
          }]
        }
      };
      const {
        value,
        sessionId,
        status
      } = (await _axios.default.post(baseUrl, combinedCaps)).data;
      status.should.exist;
      sessionId.should.exist;
      value.should.deep.equal(caps);
      await _axios.default.delete(`${baseUrl}/${sessionId}`);
    });
    it('should fall back to MJSONWP if Inner Driver is not ready for W3C', async function () {
      const combinedCaps = {
        desiredCapabilities: { ...caps
        },
        capabilities: {
          alwaysMatch: { ...caps,
            deviceName: null
          }
        }
      };

      const createSessionStub = _sinon.default.stub(_appiumFakeDriver.FakeDriver.prototype, 'createSession').callsFake(async function (jsonwpCaps) {
        const res = await _appiumBaseDriver.BaseDriver.prototype.createSession.call(this, jsonwpCaps);
        this.protocol.should.equal('MJSONWP');
        return res;
      });

      const {
        value,
        sessionId,
        status
      } = (await _axios.default.post(baseUrl, combinedCaps)).data;
      status.should.exist;
      sessionId.should.exist;
      value.should.deep.equal(caps);
      createSessionStub.restore();
      await _axios.default.delete(`${baseUrl}/${sessionId}`);
    });
    it('should handle concurrent MJSONWP and W3C sessions', async function () {
      const combinedCaps = {
        desiredCapabilities: { ...caps
        },
        capabilities: {
          alwaysMatch: { ...caps
          },
          firstMatch: []
        }
      };
      const {
        sessionId: mjsonwpSessId,
        value: mjsonwpValue,
        status
      } = (await _axios.default.post(baseUrl, _lodash.default.omit(combinedCaps, 'capabilities'))).data;
      status.should.exist;
      mjsonwpValue.should.eql(caps);
      mjsonwpSessId.should.exist;
      const {
        value
      } = (await _axios.default.post(baseUrl, _lodash.default.omit(combinedCaps, 'desiredCapabilities'))).data;
      const w3cSessId = value.sessionId;
      w3cSessId.should.exist;
      value.capabilities.should.eql(caps);
      const mjsonwpPayload = (await _axios.default.get(`${baseUrl}/${mjsonwpSessId}`)).data;
      mjsonwpPayload.sessionId.should.exist;
      mjsonwpPayload.status.should.exist;
      mjsonwpPayload.value.should.eql(caps);
      const w3cPayload = (await _axios.default.get(`${baseUrl}/${w3cSessId}`)).data;
      should.not.exist(w3cPayload.sessionId);
      should.not.exist(w3cPayload.status);
      w3cPayload.value.should.eql(caps);
      await _axios.default.delete(`${baseUrl}/${mjsonwpSessId}`);
      await _axios.default.delete(`${baseUrl}/${w3cSessId}`);
    });
  });
});
describe('Logsink', function () {
  let server = null;
  let logs = [];

  let logHandler = function (level, message) {
    logs.push([level, message]);
  };

  let args = {
    port: _helpers.TEST_PORT,
    host: _helpers.TEST_HOST,
    logHandler
  };
  before(async function () {
    server = await (0, _main.main)(args);
  });
  after(async function () {
    await server.close();
  });
  it('should send logs to a logHandler passed in by a parent package', function () {
    logs.length.should.be.above(1);
    let welcomeIndex = logs[0][1].includes('versions of node') ? 1 : 0;
    logs[welcomeIndex].length.should.equal(2);
    logs[welcomeIndex][1].should.include('Welcome to Appium');
  });
});require('source-map-support').install();


//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInRlc3QvZHJpdmVyLWUyZS1zcGVjcy5qcyJdLCJuYW1lcyI6WyJjaGFpIiwidXNlIiwiY2hhaUFzUHJvbWlzZWQiLCJzaG91bGQiLCJzaG91bGRTdGFydFNlcnZlciIsInByb2Nlc3MiLCJlbnYiLCJVU0VfUlVOTklOR19TRVJWRVIiLCJjYXBzIiwicGxhdGZvcm1OYW1lIiwiZGV2aWNlTmFtZSIsImFwcCIsIlRFU1RfRkFLRV9BUFAiLCJkZXNjcmliZSIsInNlcnZlciIsImJhc2VVcmwiLCJURVNUX0hPU1QiLCJURVNUX1BPUlQiLCJiZWZvcmUiLCJhcmdzIiwicG9ydCIsImhvc3QiLCJhZnRlciIsImNsb3NlIiwiaXQiLCJkcml2ZXIiLCJ3ZCIsInByb21pc2VDaGFpblJlbW90ZSIsInNlc3Npb25JZCIsImluaXQiLCJleGlzdCIsImJlIiwiYSIsInF1aXQiLCJ0aXRsZSIsImV2ZW50dWFsbHkiLCJyZWplY3RlZFdpdGgiLCJkcml2ZXIxIiwic2Vzc2lvbklkMSIsImRyaXZlcjIiLCJzZXNzaW9uSWQyIiwibm90IiwiZXF1YWwiLCJ1bmlxdWVDYXBzIiwiXyIsImNsb25lIiwidW5pcXVlQXBwIiwicmVqZWN0ZWQiLCJsb2NhbENhcHMiLCJPYmplY3QiLCJhc3NpZ24iLCJuZXdDb21tYW5kVGltZW91dCIsIkIiLCJkZWxheSIsInNvdXJjZSIsInczY0NhcHMiLCJjYXBhYmlsaXRpZXMiLCJhbHdheXNNYXRjaCIsImZpcnN0TWF0Y2giLCJzdGF0dXMiLCJ2YWx1ZSIsImF4aW9zIiwicG9zdCIsImRhdGEiLCJzdHJpbmciLCJkZWVwIiwic2NyZWVuc2hvdFN0YXR1cyIsInNjcmVlbnNob3RWYWx1ZSIsInVybCIsInNjcmlwdCIsImRlbGV0ZSIsImJhZFczQ2NhcHMiLCJjb21iaW5lZENhcHMiLCJ3M2NQYXJhbSIsImF1dG9tYXRpb25OYW1lIiwiYW5vdGhlclBhcmFtIiwiZGVzaXJlZENhcGFiaWxpdGllcyIsImNyZWF0ZVNlc3Npb25TdHViIiwic2lub24iLCJzdHViIiwiRmFrZURyaXZlciIsInByb3RvdHlwZSIsImNhbGxzRmFrZSIsImpzb253cENhcHMiLCJyZXMiLCJCYXNlRHJpdmVyIiwiY3JlYXRlU2Vzc2lvbiIsImNhbGwiLCJwcm90b2NvbCIsInJlc3RvcmUiLCJtanNvbndwU2Vzc0lkIiwibWpzb253cFZhbHVlIiwib21pdCIsImVxbCIsInczY1Nlc3NJZCIsIm1qc29ud3BQYXlsb2FkIiwiZ2V0IiwidzNjUGF5bG9hZCIsImxvZ3MiLCJsb2dIYW5kbGVyIiwibGV2ZWwiLCJtZXNzYWdlIiwicHVzaCIsImxlbmd0aCIsImFib3ZlIiwid2VsY29tZUluZGV4IiwiaW5jbHVkZXMiLCJpbmNsdWRlIl0sIm1hcHBpbmdzIjoiOzs7Ozs7QUFFQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFFQUEsY0FBS0MsR0FBTCxDQUFTQyx1QkFBVDs7QUFFQSxNQUFNQyxNQUFNLEdBQUdILGNBQUtHLE1BQUwsRUFBZjs7QUFDQSxNQUFNQyxpQkFBaUIsR0FBR0MsT0FBTyxDQUFDQyxHQUFSLENBQVlDLGtCQUFaLEtBQW1DLEdBQTdEO0FBQ0EsTUFBTUMsSUFBSSxHQUFHO0FBQUNDLEVBQUFBLFlBQVksRUFBRSxNQUFmO0FBQXVCQyxFQUFBQSxVQUFVLEVBQUUsTUFBbkM7QUFBMkNDLEVBQUFBLEdBQUcsRUFBRUM7QUFBaEQsQ0FBYjtBQUVBQyxRQUFRLENBQUMsdUJBQUQsRUFBMEIsWUFBWTtBQUM1QyxNQUFJQyxNQUFNLEdBQUcsSUFBYjtBQUNBLFFBQU1DLE9BQU8sR0FBSSxVQUFTQyxrQkFBVSxJQUFHQyxrQkFBVSxpQkFBakQ7QUFDQUMsRUFBQUEsTUFBTSxDQUFDLGtCQUFrQjtBQUN2QixRQUFJZCxpQkFBSixFQUF1QjtBQUNyQixVQUFJZSxJQUFJLEdBQUc7QUFBQ0MsUUFBQUEsSUFBSSxFQUFFSCxrQkFBUDtBQUFrQkksUUFBQUEsSUFBSSxFQUFFTDtBQUF4QixPQUFYO0FBQ0FGLE1BQUFBLE1BQU0sR0FBRyxNQUFNLGdCQUFhSyxJQUFiLENBQWY7QUFDRDtBQUNGLEdBTEssQ0FBTjtBQU1BRyxFQUFBQSxLQUFLLENBQUMsa0JBQWtCO0FBQ3RCLFFBQUlSLE1BQUosRUFBWTtBQUNWLFlBQU1BLE1BQU0sQ0FBQ1MsS0FBUCxFQUFOO0FBQ0Q7QUFDRixHQUpJLENBQUw7QUFNQVYsRUFBQUEsUUFBUSxDQUFDLGtCQUFELEVBQXFCLFlBQVk7QUFDdkNXLElBQUFBLEVBQUUsQ0FBQyxpQ0FBRCxFQUFvQyxrQkFBa0I7QUFDdEQsVUFBSUMsTUFBTSxHQUFHQyxZQUFHQyxrQkFBSCxDQUFzQlgsa0JBQXRCLEVBQWlDQyxrQkFBakMsQ0FBYjs7QUFDQSxVQUFJLENBQUNXLFNBQUQsSUFBYyxNQUFNSCxNQUFNLENBQUNJLElBQVAsQ0FBWXJCLElBQVosQ0FBeEI7QUFDQUwsTUFBQUEsTUFBTSxDQUFDMkIsS0FBUCxDQUFhRixTQUFiO0FBQ0FBLE1BQUFBLFNBQVMsQ0FBQ3pCLE1BQVYsQ0FBaUI0QixFQUFqQixDQUFvQkMsQ0FBcEIsQ0FBc0IsUUFBdEI7QUFDQSxZQUFNUCxNQUFNLENBQUNRLElBQVAsRUFBTjtBQUNBLFlBQU1SLE1BQU0sQ0FBQ1MsS0FBUCxHQUFlL0IsTUFBZixDQUFzQmdDLFVBQXRCLENBQWlDSixFQUFqQyxDQUFvQ0ssWUFBcEMsQ0FBaUQsWUFBakQsQ0FBTjtBQUNELEtBUEMsQ0FBRjtBQVNBWixJQUFBQSxFQUFFLENBQUMsOERBQUQsRUFBaUUsa0JBQWtCO0FBQ25GLFVBQUlhLE9BQU8sR0FBR1gsWUFBR0Msa0JBQUgsQ0FBc0JYLGtCQUF0QixFQUFpQ0Msa0JBQWpDLENBQWQ7O0FBQ0EsVUFBSSxDQUFDcUIsVUFBRCxJQUFlLE1BQU1ELE9BQU8sQ0FBQ1IsSUFBUixDQUFhckIsSUFBYixDQUF6QjtBQUNBTCxNQUFBQSxNQUFNLENBQUMyQixLQUFQLENBQWFRLFVBQWI7QUFDQUEsTUFBQUEsVUFBVSxDQUFDbkMsTUFBWCxDQUFrQjRCLEVBQWxCLENBQXFCQyxDQUFyQixDQUF1QixRQUF2Qjs7QUFDQSxVQUFJTyxPQUFPLEdBQUdiLFlBQUdDLGtCQUFILENBQXNCWCxrQkFBdEIsRUFBaUNDLGtCQUFqQyxDQUFkOztBQUNBLFVBQUksQ0FBQ3VCLFVBQUQsSUFBZSxNQUFNRCxPQUFPLENBQUNWLElBQVIsQ0FBYXJCLElBQWIsQ0FBekI7QUFDQUwsTUFBQUEsTUFBTSxDQUFDMkIsS0FBUCxDQUFhVSxVQUFiO0FBQ0FBLE1BQUFBLFVBQVUsQ0FBQ3JDLE1BQVgsQ0FBa0I0QixFQUFsQixDQUFxQkMsQ0FBckIsQ0FBdUIsUUFBdkI7QUFDQU0sTUFBQUEsVUFBVSxDQUFDbkMsTUFBWCxDQUFrQnNDLEdBQWxCLENBQXNCQyxLQUF0QixDQUE0QkYsVUFBNUI7QUFDQSxZQUFNSCxPQUFPLENBQUNKLElBQVIsRUFBTjtBQUNBLFlBQU1NLE9BQU8sQ0FBQ04sSUFBUixFQUFOO0FBQ0QsS0FaQyxDQUFGO0FBY0FULElBQUFBLEVBQUUsQ0FBQyxxRkFBRCxFQUF3RixrQkFBa0I7QUFDMUcsVUFBSW1CLFVBQVUsR0FBR0MsZ0JBQUVDLEtBQUYsQ0FBUXJDLElBQVIsQ0FBakI7O0FBQ0FtQyxNQUFBQSxVQUFVLENBQUNHLFNBQVgsR0FBdUIsSUFBdkI7O0FBQ0EsVUFBSVQsT0FBTyxHQUFHWCxZQUFHQyxrQkFBSCxDQUFzQlgsa0JBQXRCLEVBQWlDQyxrQkFBakMsQ0FBZDs7QUFDQSxVQUFJLENBQUNxQixVQUFELElBQWUsTUFBTUQsT0FBTyxDQUFDUixJQUFSLENBQWFjLFVBQWIsQ0FBekI7QUFDQXhDLE1BQUFBLE1BQU0sQ0FBQzJCLEtBQVAsQ0FBYVEsVUFBYjtBQUNBQSxNQUFBQSxVQUFVLENBQUNuQyxNQUFYLENBQWtCNEIsRUFBbEIsQ0FBcUJDLENBQXJCLENBQXVCLFFBQXZCOztBQUNBLFVBQUlPLE9BQU8sR0FBR2IsWUFBR0Msa0JBQUgsQ0FBc0JYLGtCQUF0QixFQUFpQ0Msa0JBQWpDLENBQWQ7O0FBQ0EsWUFBTXNCLE9BQU8sQ0FBQ1YsSUFBUixDQUFhckIsSUFBYixFQUFtQkwsTUFBbkIsQ0FBMEJnQyxVQUExQixDQUFxQ0osRUFBckMsQ0FBd0NnQixRQUE5QztBQUNBLFlBQU1WLE9BQU8sQ0FBQ0osSUFBUixFQUFOO0FBQ0QsS0FWQyxDQUFGO0FBWUFULElBQUFBLEVBQUUsQ0FBQywwRUFBRCxFQUE2RSxrQkFBa0I7QUFDL0YsVUFBSUMsTUFBTSxHQUFHQyxZQUFHQyxrQkFBSCxDQUFzQlgsa0JBQXRCLEVBQWlDQyxrQkFBakMsQ0FBYjs7QUFFQSxVQUFJK0IsU0FBUyxHQUFHQyxNQUFNLENBQUNDLE1BQVAsQ0FBYztBQUM1QkMsUUFBQUEsaUJBQWlCLEVBQUU7QUFEUyxPQUFkLEVBRWIzQyxJQUZhLENBQWhCO0FBSUEsVUFBSSxDQUFDb0IsU0FBRCxJQUFjLE1BQU1ILE1BQU0sQ0FBQ0ksSUFBUCxDQUFZbUIsU0FBWixDQUF4QjtBQUNBN0MsTUFBQUEsTUFBTSxDQUFDMkIsS0FBUCxDQUFhRixTQUFiO0FBRUEsWUFBTXdCLGtCQUFFQyxLQUFGLENBQVEsR0FBUixDQUFOO0FBQ0EsWUFBTTVCLE1BQU0sQ0FBQzZCLE1BQVAsR0FBZ0JuRCxNQUFoQixDQUF1QmdDLFVBQXZCLENBQWtDSixFQUFsQyxDQUFxQ0ssWUFBckMsQ0FBa0QsWUFBbEQsQ0FBTjtBQUNELEtBWkMsQ0FBRjtBQWNBWixJQUFBQSxFQUFFLENBQUMsOERBQUQsRUFBaUUsa0JBQWtCO0FBRW5GLFlBQU0rQixPQUFPLEdBQUc7QUFDZEMsUUFBQUEsWUFBWSxFQUFFO0FBQ1pDLFVBQUFBLFdBQVcsRUFBRTtBQUFDaEQsWUFBQUEsWUFBWSxFQUFFO0FBQWYsV0FERDtBQUVaaUQsVUFBQUEsVUFBVSxFQUFFLENBQUM7QUFBQyxpQ0FBcUIsTUFBdEI7QUFBOEIsMEJBQWM5QztBQUE1QyxXQUFEO0FBRkE7QUFEQSxPQUFoQjtBQVFBLFlBQU07QUFBQytDLFFBQUFBLE1BQUQ7QUFBU0MsUUFBQUEsS0FBVDtBQUFnQmhDLFFBQUFBO0FBQWhCLFVBQTZCLENBQUMsTUFBTWlDLGVBQU1DLElBQU4sQ0FBVy9DLE9BQVgsRUFBb0J3QyxPQUFwQixDQUFQLEVBQXFDUSxJQUF4RTtBQUNBNUQsTUFBQUEsTUFBTSxDQUFDc0MsR0FBUCxDQUFXWCxLQUFYLENBQWlCNkIsTUFBakI7QUFDQXhELE1BQUFBLE1BQU0sQ0FBQ3NDLEdBQVAsQ0FBV1gsS0FBWCxDQUFpQkYsU0FBakI7QUFDQWdDLE1BQUFBLEtBQUssQ0FBQ2hDLFNBQU4sQ0FBZ0J6QixNQUFoQixDQUF1QjRCLEVBQXZCLENBQTBCQyxDQUExQixDQUE0QmdDLE1BQTVCO0FBQ0FKLE1BQUFBLEtBQUssQ0FBQ3pELE1BQU4sQ0FBYTJCLEtBQWI7QUFDQThCLE1BQUFBLEtBQUssQ0FBQ0osWUFBTixDQUFtQnJELE1BQW5CLENBQTBCOEQsSUFBMUIsQ0FBK0J2QixLQUEvQixDQUFxQztBQUNuQ2pDLFFBQUFBLFlBQVksRUFBRSxNQURxQjtBQUVuQ0MsUUFBQUEsVUFBVSxFQUFFLE1BRnVCO0FBR25DQyxRQUFBQSxHQUFHLEVBQUVDO0FBSDhCLE9BQXJDO0FBT0EsWUFBTTtBQUFDK0MsUUFBQUEsTUFBTSxFQUFFTyxnQkFBVDtBQUEyQk4sUUFBQUEsS0FBSyxFQUFFTztBQUFsQyxVQUFxRCxDQUFDLE1BQU0sb0JBQU07QUFBQ0MsUUFBQUEsR0FBRyxFQUFHLEdBQUVyRCxPQUFRLElBQUc2QyxLQUFLLENBQUNoQyxTQUFVO0FBQXBDLE9BQU4sQ0FBUCxFQUFpRW1DLElBQTVIO0FBQ0E1RCxNQUFBQSxNQUFNLENBQUNzQyxHQUFQLENBQVdYLEtBQVgsQ0FBaUJvQyxnQkFBakI7QUFDQUMsTUFBQUEsZUFBZSxDQUFDaEUsTUFBaEIsQ0FBdUJ1QyxLQUF2QixDQUE2Qiw0QkFBN0I7QUFHQSxZQUFNbUIsZUFBTUMsSUFBTixDQUNILEdBQUUvQyxPQUFRLElBQUc2QyxLQUFLLENBQUNoQyxTQUFVLGdCQUQxQixFQUVKO0FBQUN5QyxRQUFBQSxNQUFNLEVBQUUsRUFBVDtBQUFhbEQsUUFBQUEsSUFBSSxFQUFFLENBQUMsR0FBRDtBQUFuQixPQUZJLEVBRXVCaEIsTUFGdkIsQ0FFOEJnQyxVQUY5QixDQUV5Q0osRUFGekMsQ0FFNENLLFlBRjVDLENBRXlELEtBRnpELENBQU47QUFLQSxZQUFNeUIsZUFBTVMsTUFBTixDQUFjLEdBQUV2RCxPQUFRLElBQUc2QyxLQUFLLENBQUNoQyxTQUFVLEVBQTNDLENBQU47QUFDRCxLQWpDQyxDQUFGO0FBbUNBSixJQUFBQSxFQUFFLENBQUMsb0ZBQUQsRUFBdUYsa0JBQWtCO0FBQ3pHLFlBQU0rQyxVQUFVLEdBQUc7QUFDakJmLFFBQUFBLFlBQVksRUFBRTtBQUNaQyxVQUFBQSxXQUFXLEVBQUUsRUFERDtBQUVaQyxVQUFBQSxVQUFVLEVBQUUsQ0FBQztBQUFDLGlDQUFxQixNQUF0QjtBQUE4QiwwQkFBYzlDO0FBQTVDLFdBQUQ7QUFGQTtBQURHLE9BQW5CO0FBT0EsWUFBTWlELGVBQU1DLElBQU4sQ0FBVy9DLE9BQVgsRUFBb0J3RCxVQUFwQixFQUFnQ3BFLE1BQWhDLENBQXVDZ0MsVUFBdkMsQ0FBa0RKLEVBQWxELENBQXFESyxZQUFyRCxDQUFrRSxLQUFsRSxDQUFOO0FBQ0QsS0FUQyxDQUFGO0FBV0FaLElBQUFBLEVBQUUsQ0FBQyx5RUFBRCxFQUE0RSxrQkFBa0I7QUFDOUYsWUFBTWdELFlBQVksR0FBRztBQUNuQiwrQkFBdUIsRUFDckIsR0FBR2hFO0FBRGtCLFNBREo7QUFJbkIsd0JBQWdCO0FBQ2QseUJBQWUsRUFBQyxHQUFHQTtBQUFKLFdBREQ7QUFFZCx3QkFBYyxDQUFDO0FBQ2JpRSxZQUFBQSxRQUFRLEVBQUU7QUFERyxXQUFEO0FBRkE7QUFKRyxPQUFyQjtBQVlBLFlBQU07QUFBQ2QsUUFBQUEsTUFBRDtBQUFTQyxRQUFBQSxLQUFUO0FBQWdCaEMsUUFBQUE7QUFBaEIsVUFBNkIsQ0FBQyxNQUFNaUMsZUFBTUMsSUFBTixDQUFXL0MsT0FBWCxFQUFvQnlELFlBQXBCLENBQVAsRUFBMENULElBQTdFO0FBQ0E1RCxNQUFBQSxNQUFNLENBQUNzQyxHQUFQLENBQVdYLEtBQVgsQ0FBaUI2QixNQUFqQjtBQUNBeEQsTUFBQUEsTUFBTSxDQUFDc0MsR0FBUCxDQUFXWCxLQUFYLENBQWlCRixTQUFqQjtBQUNBZ0MsTUFBQUEsS0FBSyxDQUFDaEMsU0FBTixDQUFnQnpCLE1BQWhCLENBQXVCMkIsS0FBdkI7QUFDQThCLE1BQUFBLEtBQUssQ0FBQ0osWUFBTixDQUFtQnJELE1BQW5CLENBQTBCOEQsSUFBMUIsQ0FBK0J2QixLQUEvQixDQUFxQyxFQUNuQyxHQUFHbEMsSUFEZ0M7QUFFbkNpRSxRQUFBQSxRQUFRLEVBQUU7QUFGeUIsT0FBckM7QUFNQSxZQUFNWixlQUFNUyxNQUFOLENBQWMsR0FBRXZELE9BQVEsSUFBRzZDLEtBQUssQ0FBQ2hDLFNBQVUsRUFBM0MsQ0FBTjtBQUNELEtBeEJDLENBQUY7QUEwQkFKLElBQUFBLEVBQUUsQ0FBQyx3SEFBRCxFQUEySCxrQkFBa0I7QUFDN0ksWUFBTWdELFlBQVksR0FBRztBQUNuQiwrQkFBdUIsRUFDckIsR0FBR2hFLElBRGtCO0FBRXJCa0UsVUFBQUEsY0FBYyxFQUFFLE1BRks7QUFHckJDLFVBQUFBLFlBQVksRUFBRTtBQUhPLFNBREo7QUFNbkIsd0JBQWdCO0FBQ2QseUJBQWUsRUFBQyxHQUFHbkU7QUFBSixXQUREO0FBRWQsd0JBQWMsQ0FBQztBQUNiaUUsWUFBQUEsUUFBUSxFQUFFO0FBREcsV0FBRDtBQUZBO0FBTkcsT0FBckI7QUFjQSxZQUFNO0FBQUM3QyxRQUFBQSxTQUFEO0FBQVkrQixRQUFBQSxNQUFaO0FBQW9CQyxRQUFBQTtBQUFwQixVQUE2QixDQUFDLE1BQU1DLGVBQU1DLElBQU4sQ0FBVy9DLE9BQVgsRUFBb0J5RCxZQUFwQixDQUFQLEVBQTBDVCxJQUE3RTtBQUNBNUQsTUFBQUEsTUFBTSxDQUFDc0MsR0FBUCxDQUFXWCxLQUFYLENBQWlCRixTQUFqQjtBQUNBekIsTUFBQUEsTUFBTSxDQUFDc0MsR0FBUCxDQUFXWCxLQUFYLENBQWlCNkIsTUFBakI7QUFDQUMsTUFBQUEsS0FBSyxDQUFDaEMsU0FBTixDQUFnQnpCLE1BQWhCLENBQXVCMkIsS0FBdkI7QUFDQThCLE1BQUFBLEtBQUssQ0FBQ0osWUFBTixDQUFtQnJELE1BQW5CLENBQTBCOEQsSUFBMUIsQ0FBK0J2QixLQUEvQixDQUFxQyxFQUNuQyxHQUFHbEMsSUFEZ0M7QUFFbkNrRSxRQUFBQSxjQUFjLEVBQUUsTUFGbUI7QUFHbkNDLFFBQUFBLFlBQVksRUFBRSxPQUhxQjtBQUluQ0YsUUFBQUEsUUFBUSxFQUFFO0FBSnlCLE9BQXJDO0FBUUEsWUFBTVosZUFBTVMsTUFBTixDQUFjLEdBQUV2RCxPQUFRLElBQUc2QyxLQUFLLENBQUNoQyxTQUFVLEVBQTNDLENBQU47QUFDRCxLQTVCQyxDQUFGO0FBOEJBSixJQUFBQSxFQUFFLENBQUMsb0VBQUQsRUFBdUUsa0JBQWtCO0FBQ3pGLFlBQU0rQixPQUFPLEdBQUc7QUFDZEMsUUFBQUEsWUFBWSxFQUFFO0FBQ1pDLFVBQUFBLFdBQVcsRUFBRSxFQUNYLEdBQUdqRCxJQURRO0FBRVhrRSxZQUFBQSxjQUFjLEVBQUU7QUFGTDtBQUREO0FBREEsT0FBaEI7QUFRQSxZQUFNYixlQUFNQyxJQUFOLENBQVcvQyxPQUFYLEVBQW9Cd0MsT0FBcEIsRUFBNkJwRCxNQUE3QixDQUFvQ2dDLFVBQXBDLENBQStDSixFQUEvQyxDQUFrREssWUFBbEQsQ0FBK0QsS0FBL0QsQ0FBTjtBQUNELEtBVkMsQ0FBRjtBQVlBWixJQUFBQSxFQUFFLENBQUMsc0VBQUQsRUFBeUUsa0JBQWtCO0FBQzNGLFlBQU0rQixPQUFPLEdBQUc7QUFDZEMsUUFBQUEsWUFBWSxFQUFFO0FBQ1pDLFVBQUFBLFdBQVcsRUFBRSxFQUREO0FBRVpDLFVBQUFBLFVBQVUsRUFBRSxDQUFDLEVBQUQsRUFBSyxFQUNmLEdBQUdsRDtBQURZLFdBQUw7QUFGQTtBQURBLE9BQWhCO0FBUUEsWUFBTTtBQUFDb0QsUUFBQUEsS0FBRDtBQUFRaEMsUUFBQUEsU0FBUjtBQUFtQitCLFFBQUFBO0FBQW5CLFVBQTZCLENBQUMsTUFBTUUsZUFBTUMsSUFBTixDQUFXL0MsT0FBWCxFQUFvQndDLE9BQXBCLENBQVAsRUFBcUNRLElBQXhFO0FBQ0E1RCxNQUFBQSxNQUFNLENBQUNzQyxHQUFQLENBQVdYLEtBQVgsQ0FBaUI2QixNQUFqQjtBQUNBeEQsTUFBQUEsTUFBTSxDQUFDc0MsR0FBUCxDQUFXWCxLQUFYLENBQWlCRixTQUFqQjtBQUNBZ0MsTUFBQUEsS0FBSyxDQUFDSixZQUFOLENBQW1CckQsTUFBbkIsQ0FBMEI4RCxJQUExQixDQUErQnZCLEtBQS9CLENBQXFDbEMsSUFBckM7QUFHQSxZQUFNcUQsZUFBTVMsTUFBTixDQUFjLEdBQUV2RCxPQUFRLElBQUc2QyxLQUFLLENBQUNoQyxTQUFVLEVBQTNDLENBQU47QUFDRCxLQWhCQyxDQUFGO0FBa0JBSixJQUFBQSxFQUFFLENBQUMscURBQUQsRUFBd0Qsa0JBQWtCO0FBQzFFLFlBQU1nRCxZQUFZLEdBQUc7QUFDbkJJLFFBQUFBLG1CQUFtQixFQUFFLEVBQ25CLEdBQUdwRTtBQURnQixTQURGO0FBSW5CZ0QsUUFBQUEsWUFBWSxFQUFFO0FBQ1pDLFVBQUFBLFdBQVcsRUFBRSxFQUREO0FBRVpDLFVBQUFBLFVBQVUsRUFBRSxDQUFDLEVBQUQsRUFBSyxFQUNmLEdBQUdsRCxJQURZO0FBRWZDLFlBQUFBLFlBQVksRUFBRTtBQUZDLFdBQUw7QUFGQTtBQUpLLE9BQXJCO0FBWUEsWUFBTTtBQUFDbUQsUUFBQUEsS0FBRDtBQUFRaEMsUUFBQUEsU0FBUjtBQUFtQitCLFFBQUFBO0FBQW5CLFVBQTZCLENBQUMsTUFBTUUsZUFBTUMsSUFBTixDQUFXL0MsT0FBWCxFQUFvQnlELFlBQXBCLENBQVAsRUFBMENULElBQTdFO0FBQ0FKLE1BQUFBLE1BQU0sQ0FBQ3hELE1BQVAsQ0FBYzJCLEtBQWQ7QUFDQUYsTUFBQUEsU0FBUyxDQUFDekIsTUFBVixDQUFpQjJCLEtBQWpCO0FBQ0E4QixNQUFBQSxLQUFLLENBQUN6RCxNQUFOLENBQWE4RCxJQUFiLENBQWtCdkIsS0FBbEIsQ0FBd0JsQyxJQUF4QjtBQUdBLFlBQU1xRCxlQUFNUyxNQUFOLENBQWMsR0FBRXZELE9BQVEsSUFBR2EsU0FBVSxFQUFyQyxDQUFOO0FBQ0QsS0FwQkMsQ0FBRjtBQXNCQUosSUFBQUEsRUFBRSxDQUFDLGtFQUFELEVBQXFFLGtCQUFrQjtBQUN2RixZQUFNZ0QsWUFBWSxHQUFHO0FBQ25CSSxRQUFBQSxtQkFBbUIsRUFBRSxFQUNuQixHQUFHcEU7QUFEZ0IsU0FERjtBQUluQmdELFFBQUFBLFlBQVksRUFBRTtBQUNaQyxVQUFBQSxXQUFXLEVBQUUsRUFDWCxHQUFHakQsSUFEUTtBQUVYRSxZQUFBQSxVQUFVLEVBQUU7QUFGRDtBQUREO0FBSkssT0FBckI7O0FBV0EsWUFBTW1FLGlCQUFpQixHQUFHQyxlQUFNQyxJQUFOLENBQVdDLDZCQUFXQyxTQUF0QixFQUFpQyxlQUFqQyxFQUFrREMsU0FBbEQsQ0FBNEQsZ0JBQWdCQyxVQUFoQixFQUE0QjtBQUNoSCxjQUFNQyxHQUFHLEdBQUcsTUFBTUMsNkJBQVdKLFNBQVgsQ0FBcUJLLGFBQXJCLENBQW1DQyxJQUFuQyxDQUF3QyxJQUF4QyxFQUE4Q0osVUFBOUMsQ0FBbEI7QUFDQSxhQUFLSyxRQUFMLENBQWNyRixNQUFkLENBQXFCdUMsS0FBckIsQ0FBMkIsU0FBM0I7QUFDQSxlQUFPMEMsR0FBUDtBQUNELE9BSnlCLENBQTFCOztBQU1BLFlBQU07QUFBQ3hCLFFBQUFBLEtBQUQ7QUFBUWhDLFFBQUFBLFNBQVI7QUFBbUIrQixRQUFBQTtBQUFuQixVQUE2QixDQUFDLE1BQU1FLGVBQU1DLElBQU4sQ0FBVy9DLE9BQVgsRUFBb0J5RCxZQUFwQixDQUFQLEVBQTBDVCxJQUE3RTtBQUNBSixNQUFBQSxNQUFNLENBQUN4RCxNQUFQLENBQWMyQixLQUFkO0FBQ0FGLE1BQUFBLFNBQVMsQ0FBQ3pCLE1BQVYsQ0FBaUIyQixLQUFqQjtBQUNBOEIsTUFBQUEsS0FBSyxDQUFDekQsTUFBTixDQUFhOEQsSUFBYixDQUFrQnZCLEtBQWxCLENBQXdCbEMsSUFBeEI7QUFFQXFFLE1BQUFBLGlCQUFpQixDQUFDWSxPQUFsQjtBQUdBLFlBQU01QixlQUFNUyxNQUFOLENBQWMsR0FBRXZELE9BQVEsSUFBR2EsU0FBVSxFQUFyQyxDQUFOO0FBQ0QsS0EzQkMsQ0FBRjtBQTZCQUosSUFBQUEsRUFBRSxDQUFDLG1EQUFELEVBQXNELGtCQUFrQjtBQUN4RSxZQUFNZ0QsWUFBWSxHQUFHO0FBQ25CSSxRQUFBQSxtQkFBbUIsRUFBRSxFQUNuQixHQUFHcEU7QUFEZ0IsU0FERjtBQUluQmdELFFBQUFBLFlBQVksRUFBRTtBQUNaQyxVQUFBQSxXQUFXLEVBQUUsRUFDWCxHQUFHakQ7QUFEUSxXQUREO0FBSVprRCxVQUFBQSxVQUFVLEVBQUU7QUFKQTtBQUpLLE9BQXJCO0FBYUEsWUFBTTtBQUFDOUIsUUFBQUEsU0FBUyxFQUFFOEQsYUFBWjtBQUEyQjlCLFFBQUFBLEtBQUssRUFBRStCLFlBQWxDO0FBQWdEaEMsUUFBQUE7QUFBaEQsVUFBMEQsQ0FBQyxNQUFNRSxlQUFNQyxJQUFOLENBQVcvQyxPQUFYLEVBQW9CNkIsZ0JBQUVnRCxJQUFGLENBQU9wQixZQUFQLEVBQXFCLGNBQXJCLENBQXBCLENBQVAsRUFBa0VULElBQWxJO0FBQ0FKLE1BQUFBLE1BQU0sQ0FBQ3hELE1BQVAsQ0FBYzJCLEtBQWQ7QUFDQTZELE1BQUFBLFlBQVksQ0FBQ3hGLE1BQWIsQ0FBb0IwRixHQUFwQixDQUF3QnJGLElBQXhCO0FBQ0FrRixNQUFBQSxhQUFhLENBQUN2RixNQUFkLENBQXFCMkIsS0FBckI7QUFFQSxZQUFNO0FBQUM4QixRQUFBQTtBQUFELFVBQVUsQ0FBQyxNQUFNQyxlQUFNQyxJQUFOLENBQVcvQyxPQUFYLEVBQW9CNkIsZ0JBQUVnRCxJQUFGLENBQU9wQixZQUFQLEVBQXFCLHFCQUFyQixDQUFwQixDQUFQLEVBQXlFVCxJQUF6RjtBQUNBLFlBQU0rQixTQUFTLEdBQUdsQyxLQUFLLENBQUNoQyxTQUF4QjtBQUNBa0UsTUFBQUEsU0FBUyxDQUFDM0YsTUFBVixDQUFpQjJCLEtBQWpCO0FBQ0E4QixNQUFBQSxLQUFLLENBQUNKLFlBQU4sQ0FBbUJyRCxNQUFuQixDQUEwQjBGLEdBQTFCLENBQThCckYsSUFBOUI7QUFHQSxZQUFNdUYsY0FBYyxHQUFHLENBQUMsTUFBTWxDLGVBQU1tQyxHQUFOLENBQVcsR0FBRWpGLE9BQVEsSUFBRzJFLGFBQWMsRUFBdEMsQ0FBUCxFQUFpRDNCLElBQXhFO0FBQ0FnQyxNQUFBQSxjQUFjLENBQUNuRSxTQUFmLENBQXlCekIsTUFBekIsQ0FBZ0MyQixLQUFoQztBQUNBaUUsTUFBQUEsY0FBYyxDQUFDcEMsTUFBZixDQUFzQnhELE1BQXRCLENBQTZCMkIsS0FBN0I7QUFDQWlFLE1BQUFBLGNBQWMsQ0FBQ25DLEtBQWYsQ0FBcUJ6RCxNQUFyQixDQUE0QjBGLEdBQTVCLENBQWdDckYsSUFBaEM7QUFFQSxZQUFNeUYsVUFBVSxHQUFHLENBQUMsTUFBTXBDLGVBQU1tQyxHQUFOLENBQVcsR0FBRWpGLE9BQVEsSUFBRytFLFNBQVUsRUFBbEMsQ0FBUCxFQUE2Qy9CLElBQWhFO0FBQ0E1RCxNQUFBQSxNQUFNLENBQUNzQyxHQUFQLENBQVdYLEtBQVgsQ0FBaUJtRSxVQUFVLENBQUNyRSxTQUE1QjtBQUNBekIsTUFBQUEsTUFBTSxDQUFDc0MsR0FBUCxDQUFXWCxLQUFYLENBQWlCbUUsVUFBVSxDQUFDdEMsTUFBNUI7QUFDQXNDLE1BQUFBLFVBQVUsQ0FBQ3JDLEtBQVgsQ0FBaUJ6RCxNQUFqQixDQUF3QjBGLEdBQXhCLENBQTRCckYsSUFBNUI7QUFHQSxZQUFNcUQsZUFBTVMsTUFBTixDQUFjLEdBQUV2RCxPQUFRLElBQUcyRSxhQUFjLEVBQXpDLENBQU47QUFDQSxZQUFNN0IsZUFBTVMsTUFBTixDQUFjLEdBQUV2RCxPQUFRLElBQUcrRSxTQUFVLEVBQXJDLENBQU47QUFDRCxLQXRDQyxDQUFGO0FBdUNELEdBaFJPLENBQVI7QUFpUkQsQ0FoU08sQ0FBUjtBQWtTQWpGLFFBQVEsQ0FBQyxTQUFELEVBQVksWUFBWTtBQUM5QixNQUFJQyxNQUFNLEdBQUcsSUFBYjtBQUNBLE1BQUlvRixJQUFJLEdBQUcsRUFBWDs7QUFDQSxNQUFJQyxVQUFVLEdBQUcsVUFBVUMsS0FBVixFQUFpQkMsT0FBakIsRUFBMEI7QUFDekNILElBQUFBLElBQUksQ0FBQ0ksSUFBTCxDQUFVLENBQUNGLEtBQUQsRUFBUUMsT0FBUixDQUFWO0FBQ0QsR0FGRDs7QUFHQSxNQUFJbEYsSUFBSSxHQUFHO0FBQ1RDLElBQUFBLElBQUksRUFBRUgsa0JBREc7QUFFVEksSUFBQUEsSUFBSSxFQUFFTCxrQkFGRztBQUdUbUYsSUFBQUE7QUFIUyxHQUFYO0FBTUFqRixFQUFBQSxNQUFNLENBQUMsa0JBQWtCO0FBQ3ZCSixJQUFBQSxNQUFNLEdBQUcsTUFBTSxnQkFBYUssSUFBYixDQUFmO0FBQ0QsR0FGSyxDQUFOO0FBSUFHLEVBQUFBLEtBQUssQ0FBQyxrQkFBa0I7QUFDdEIsVUFBTVIsTUFBTSxDQUFDUyxLQUFQLEVBQU47QUFDRCxHQUZJLENBQUw7QUFJQUMsRUFBQUEsRUFBRSxDQUFDLGdFQUFELEVBQW1FLFlBQVk7QUFDL0UwRSxJQUFBQSxJQUFJLENBQUNLLE1BQUwsQ0FBWXBHLE1BQVosQ0FBbUI0QixFQUFuQixDQUFzQnlFLEtBQXRCLENBQTRCLENBQTVCO0FBQ0EsUUFBSUMsWUFBWSxHQUFHUCxJQUFJLENBQUMsQ0FBRCxDQUFKLENBQVEsQ0FBUixFQUFXUSxRQUFYLENBQW9CLGtCQUFwQixJQUEwQyxDQUExQyxHQUE4QyxDQUFqRTtBQUNBUixJQUFBQSxJQUFJLENBQUNPLFlBQUQsQ0FBSixDQUFtQkYsTUFBbkIsQ0FBMEJwRyxNQUExQixDQUFpQ3VDLEtBQWpDLENBQXVDLENBQXZDO0FBQ0F3RCxJQUFBQSxJQUFJLENBQUNPLFlBQUQsQ0FBSixDQUFtQixDQUFuQixFQUFzQnRHLE1BQXRCLENBQTZCd0csT0FBN0IsQ0FBcUMsbUJBQXJDO0FBQ0QsR0FMQyxDQUFGO0FBTUQsQ0ExQk8sQ0FBUiIsInNvdXJjZXNDb250ZW50IjpbIi8vIHRyYW5zcGlsZTptb2NoYVxuXG5pbXBvcnQgXyBmcm9tICdsb2Rhc2gnO1xuaW1wb3J0IEIgZnJvbSAnYmx1ZWJpcmQnO1xuaW1wb3J0IGNoYWkgZnJvbSAnY2hhaSc7XG5pbXBvcnQgY2hhaUFzUHJvbWlzZWQgZnJvbSAnY2hhaS1hcy1wcm9taXNlZCc7XG5pbXBvcnQgd2QgZnJvbSAnd2QnO1xuaW1wb3J0IGF4aW9zIGZyb20gJ2F4aW9zJztcbmltcG9ydCB7IG1haW4gYXMgYXBwaXVtU2VydmVyIH0gZnJvbSAnLi4vbGliL21haW4nO1xuaW1wb3J0IHsgVEVTVF9GQUtFX0FQUCwgVEVTVF9IT1NULCBURVNUX1BPUlQgfSBmcm9tICcuL2hlbHBlcnMnO1xuaW1wb3J0IHsgQmFzZURyaXZlciB9IGZyb20gJ2FwcGl1bS1iYXNlLWRyaXZlcic7XG5pbXBvcnQgeyBGYWtlRHJpdmVyIH0gZnJvbSAnYXBwaXVtLWZha2UtZHJpdmVyJztcbmltcG9ydCBzaW5vbiBmcm9tICdzaW5vbic7XG5cbmNoYWkudXNlKGNoYWlBc1Byb21pc2VkKTtcblxuY29uc3Qgc2hvdWxkID0gY2hhaS5zaG91bGQoKTtcbmNvbnN0IHNob3VsZFN0YXJ0U2VydmVyID0gcHJvY2Vzcy5lbnYuVVNFX1JVTk5JTkdfU0VSVkVSICE9PSAnMCc7XG5jb25zdCBjYXBzID0ge3BsYXRmb3JtTmFtZTogJ0Zha2UnLCBkZXZpY2VOYW1lOiAnRmFrZScsIGFwcDogVEVTVF9GQUtFX0FQUH07XG5cbmRlc2NyaWJlKCdGYWtlRHJpdmVyIC0gdmlhIEhUVFAnLCBmdW5jdGlvbiAoKSB7XG4gIGxldCBzZXJ2ZXIgPSBudWxsO1xuICBjb25zdCBiYXNlVXJsID0gYGh0dHA6Ly8ke1RFU1RfSE9TVH06JHtURVNUX1BPUlR9L3dkL2h1Yi9zZXNzaW9uYDtcbiAgYmVmb3JlKGFzeW5jIGZ1bmN0aW9uICgpIHtcbiAgICBpZiAoc2hvdWxkU3RhcnRTZXJ2ZXIpIHtcbiAgICAgIGxldCBhcmdzID0ge3BvcnQ6IFRFU1RfUE9SVCwgaG9zdDogVEVTVF9IT1NUfTtcbiAgICAgIHNlcnZlciA9IGF3YWl0IGFwcGl1bVNlcnZlcihhcmdzKTtcbiAgICB9XG4gIH0pO1xuICBhZnRlcihhc3luYyBmdW5jdGlvbiAoKSB7XG4gICAgaWYgKHNlcnZlcikge1xuICAgICAgYXdhaXQgc2VydmVyLmNsb3NlKCk7XG4gICAgfVxuICB9KTtcblxuICBkZXNjcmliZSgnc2Vzc2lvbiBoYW5kbGluZycsIGZ1bmN0aW9uICgpIHtcbiAgICBpdCgnc2hvdWxkIHN0YXJ0IGFuZCBzdG9wIGEgc2Vzc2lvbicsIGFzeW5jIGZ1bmN0aW9uICgpIHtcbiAgICAgIGxldCBkcml2ZXIgPSB3ZC5wcm9taXNlQ2hhaW5SZW1vdGUoVEVTVF9IT1NULCBURVNUX1BPUlQpO1xuICAgICAgbGV0IFtzZXNzaW9uSWRdID0gYXdhaXQgZHJpdmVyLmluaXQoY2Fwcyk7XG4gICAgICBzaG91bGQuZXhpc3Qoc2Vzc2lvbklkKTtcbiAgICAgIHNlc3Npb25JZC5zaG91bGQuYmUuYSgnc3RyaW5nJyk7XG4gICAgICBhd2FpdCBkcml2ZXIucXVpdCgpO1xuICAgICAgYXdhaXQgZHJpdmVyLnRpdGxlKCkuc2hvdWxkLmV2ZW50dWFsbHkuYmUucmVqZWN0ZWRXaXRoKC90ZXJtaW5hdGVkLyk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGJlIGFibGUgdG8gcnVuIHR3byBGYWtlRHJpdmVyIHNlc3Npb25zIHNpbXVsdGFuZW91c2x5JywgYXN5bmMgZnVuY3Rpb24gKCkge1xuICAgICAgbGV0IGRyaXZlcjEgPSB3ZC5wcm9taXNlQ2hhaW5SZW1vdGUoVEVTVF9IT1NULCBURVNUX1BPUlQpO1xuICAgICAgbGV0IFtzZXNzaW9uSWQxXSA9IGF3YWl0IGRyaXZlcjEuaW5pdChjYXBzKTtcbiAgICAgIHNob3VsZC5leGlzdChzZXNzaW9uSWQxKTtcbiAgICAgIHNlc3Npb25JZDEuc2hvdWxkLmJlLmEoJ3N0cmluZycpO1xuICAgICAgbGV0IGRyaXZlcjIgPSB3ZC5wcm9taXNlQ2hhaW5SZW1vdGUoVEVTVF9IT1NULCBURVNUX1BPUlQpO1xuICAgICAgbGV0IFtzZXNzaW9uSWQyXSA9IGF3YWl0IGRyaXZlcjIuaW5pdChjYXBzKTtcbiAgICAgIHNob3VsZC5leGlzdChzZXNzaW9uSWQyKTtcbiAgICAgIHNlc3Npb25JZDIuc2hvdWxkLmJlLmEoJ3N0cmluZycpO1xuICAgICAgc2Vzc2lvbklkMS5zaG91bGQubm90LmVxdWFsKHNlc3Npb25JZDIpO1xuICAgICAgYXdhaXQgZHJpdmVyMS5xdWl0KCk7XG4gICAgICBhd2FpdCBkcml2ZXIyLnF1aXQoKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgbm90IGJlIGFibGUgdG8gcnVuIHR3byBGYWtlRHJpdmVyIHNlc3Npb25zIHNpbXVsdGFuZW91c2x5IHdoZW4gb25lIGlzIHVuaXF1ZScsIGFzeW5jIGZ1bmN0aW9uICgpIHtcbiAgICAgIGxldCB1bmlxdWVDYXBzID0gXy5jbG9uZShjYXBzKTtcbiAgICAgIHVuaXF1ZUNhcHMudW5pcXVlQXBwID0gdHJ1ZTtcbiAgICAgIGxldCBkcml2ZXIxID0gd2QucHJvbWlzZUNoYWluUmVtb3RlKFRFU1RfSE9TVCwgVEVTVF9QT1JUKTtcbiAgICAgIGxldCBbc2Vzc2lvbklkMV0gPSBhd2FpdCBkcml2ZXIxLmluaXQodW5pcXVlQ2Fwcyk7XG4gICAgICBzaG91bGQuZXhpc3Qoc2Vzc2lvbklkMSk7XG4gICAgICBzZXNzaW9uSWQxLnNob3VsZC5iZS5hKCdzdHJpbmcnKTtcbiAgICAgIGxldCBkcml2ZXIyID0gd2QucHJvbWlzZUNoYWluUmVtb3RlKFRFU1RfSE9TVCwgVEVTVF9QT1JUKTtcbiAgICAgIGF3YWl0IGRyaXZlcjIuaW5pdChjYXBzKS5zaG91bGQuZXZlbnR1YWxseS5iZS5yZWplY3RlZDtcbiAgICAgIGF3YWl0IGRyaXZlcjEucXVpdCgpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCB1c2UgdGhlIG5ld0NvbW1hbmRUaW1lb3V0IG9mIHRoZSBpbm5lciBEcml2ZXIgb24gc2Vzc2lvbiBjcmVhdGlvbicsIGFzeW5jIGZ1bmN0aW9uICgpIHtcbiAgICAgIGxldCBkcml2ZXIgPSB3ZC5wcm9taXNlQ2hhaW5SZW1vdGUoVEVTVF9IT1NULCBURVNUX1BPUlQpO1xuXG4gICAgICBsZXQgbG9jYWxDYXBzID0gT2JqZWN0LmFzc2lnbih7XG4gICAgICAgIG5ld0NvbW1hbmRUaW1lb3V0OiAwLjI1LFxuICAgICAgfSwgY2Fwcyk7XG5cbiAgICAgIGxldCBbc2Vzc2lvbklkXSA9IGF3YWl0IGRyaXZlci5pbml0KGxvY2FsQ2Fwcyk7XG4gICAgICBzaG91bGQuZXhpc3Qoc2Vzc2lvbklkKTtcblxuICAgICAgYXdhaXQgQi5kZWxheSgyNTApO1xuICAgICAgYXdhaXQgZHJpdmVyLnNvdXJjZSgpLnNob3VsZC5ldmVudHVhbGx5LmJlLnJlamVjdGVkV2l0aCgvdGVybWluYXRlZC8pO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBhY2NlcHQgdmFsaWQgVzNDIGNhcGFiaWxpdGllcyBhbmQgc3RhcnQgYSBXM0Mgc2Vzc2lvbicsIGFzeW5jIGZ1bmN0aW9uICgpIHtcbiAgICAgIC8vIFRyeSB3aXRoIHZhbGlkIGNhcGFiaWxpdGllcyBhbmQgY2hlY2sgdGhhdCBpdCByZXR1cm5zIGEgc2Vzc2lvbiBJRFxuICAgICAgY29uc3QgdzNjQ2FwcyA9IHtcbiAgICAgICAgY2FwYWJpbGl0aWVzOiB7XG4gICAgICAgICAgYWx3YXlzTWF0Y2g6IHtwbGF0Zm9ybU5hbWU6ICdGYWtlJ30sXG4gICAgICAgICAgZmlyc3RNYXRjaDogW3snYXBwaXVtOmRldmljZU5hbWUnOiAnRmFrZScsICdhcHBpdW06YXBwJzogVEVTVF9GQUtFX0FQUH1dLFxuICAgICAgICB9XG4gICAgICB9O1xuXG4gICAgICAvLyBDcmVhdGUgdGhlIHNlc3Npb25cbiAgICAgIGNvbnN0IHtzdGF0dXMsIHZhbHVlLCBzZXNzaW9uSWR9ID0gKGF3YWl0IGF4aW9zLnBvc3QoYmFzZVVybCwgdzNjQ2FwcykpLmRhdGE7XG4gICAgICBzaG91bGQubm90LmV4aXN0KHN0YXR1cyk7IC8vIFRlc3QgdGhhdCBpdCdzIGEgVzNDIHNlc3Npb24gYnkgY2hlY2tpbmcgdGhhdCAnc3RhdHVzJyBpcyBub3QgaW4gdGhlIHJlc3BvbnNlXG4gICAgICBzaG91bGQubm90LmV4aXN0KHNlc3Npb25JZCk7XG4gICAgICB2YWx1ZS5zZXNzaW9uSWQuc2hvdWxkLmJlLmEuc3RyaW5nO1xuICAgICAgdmFsdWUuc2hvdWxkLmV4aXN0O1xuICAgICAgdmFsdWUuY2FwYWJpbGl0aWVzLnNob3VsZC5kZWVwLmVxdWFsKHtcbiAgICAgICAgcGxhdGZvcm1OYW1lOiAnRmFrZScsXG4gICAgICAgIGRldmljZU5hbWU6ICdGYWtlJyxcbiAgICAgICAgYXBwOiBURVNUX0ZBS0VfQVBQLFxuICAgICAgfSk7XG5cbiAgICAgIC8vIE5vdyB1c2UgdGhhdCBzZXNzaW9uSWQgdG8gY2FsbCAvc2NyZWVuc2hvdFxuICAgICAgY29uc3Qge3N0YXR1czogc2NyZWVuc2hvdFN0YXR1cywgdmFsdWU6IHNjcmVlbnNob3RWYWx1ZX0gPSAoYXdhaXQgYXhpb3Moe3VybDogYCR7YmFzZVVybH0vJHt2YWx1ZS5zZXNzaW9uSWR9L3NjcmVlbnNob3RgfSkpLmRhdGE7XG4gICAgICBzaG91bGQubm90LmV4aXN0KHNjcmVlbnNob3RTdGF0dXMpO1xuICAgICAgc2NyZWVuc2hvdFZhbHVlLnNob3VsZC5lcXVhbCgnaGFoYWhhbm90cmVhbGx5YXNjcmVlbnNob3QnKTtcblxuICAgICAgLy8gTm93IHVzZSB0aGF0IHNlc3Npb25JRCB0byBjYWxsIGFuIGFyYml0cmFyeSBXM0Mtb25seSBlbmRwb2ludCB0aGF0IGlzbid0IGltcGxlbWVudGVkIHRvIHNlZSBpZiBpdCByZXNwb25kcyB3aXRoIGNvcnJlY3QgZXJyb3JcbiAgICAgIGF3YWl0IGF4aW9zLnBvc3QoXG4gICAgICAgIGAke2Jhc2VVcmx9LyR7dmFsdWUuc2Vzc2lvbklkfS9leGVjdXRlL2FzeW5jYCxcbiAgICAgICAge3NjcmlwdDogJycsIGFyZ3M6IFsnYSddfSkuc2hvdWxkLmV2ZW50dWFsbHkuYmUucmVqZWN0ZWRXaXRoKC80MDUvKTtcblxuICAgICAgLy8gRW5kIHNlc3Npb25cbiAgICAgIGF3YWl0IGF4aW9zLmRlbGV0ZShgJHtiYXNlVXJsfS8ke3ZhbHVlLnNlc3Npb25JZH1gKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgcmVqZWN0IGludmFsaWQgVzNDIGNhcGFiaWxpdGllcyBhbmQgcmVzcG9uZCB3aXRoIGEgNDAwIEJhZCBQYXJhbWV0ZXJzIGVycm9yJywgYXN5bmMgZnVuY3Rpb24gKCkge1xuICAgICAgY29uc3QgYmFkVzNDY2FwcyA9IHtcbiAgICAgICAgY2FwYWJpbGl0aWVzOiB7XG4gICAgICAgICAgYWx3YXlzTWF0Y2g6IHt9LFxuICAgICAgICAgIGZpcnN0TWF0Y2g6IFt7J2FwcGl1bTpkZXZpY2VOYW1lJzogJ0Zha2UnLCAnYXBwaXVtOmFwcCc6IFRFU1RfRkFLRV9BUFB9XSxcbiAgICAgICAgfVxuICAgICAgfTtcblxuICAgICAgYXdhaXQgYXhpb3MucG9zdChiYXNlVXJsLCBiYWRXM0NjYXBzKS5zaG91bGQuZXZlbnR1YWxseS5iZS5yZWplY3RlZFdpdGgoLzQwMC8pO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBhY2NlcHQgYSBjb21ibyBvZiBXM0MgYW5kIEpTT05XUCBjYXBhYmlsaXRpZXMgYnV0IGRlZmF1bHQgdG8gVzNDJywgYXN5bmMgZnVuY3Rpb24gKCkge1xuICAgICAgY29uc3QgY29tYmluZWRDYXBzID0ge1xuICAgICAgICAnZGVzaXJlZENhcGFiaWxpdGllcyc6IHtcbiAgICAgICAgICAuLi5jYXBzLFxuICAgICAgICB9LFxuICAgICAgICAnY2FwYWJpbGl0aWVzJzoge1xuICAgICAgICAgICdhbHdheXNNYXRjaCc6IHsuLi5jYXBzfSxcbiAgICAgICAgICAnZmlyc3RNYXRjaCc6IFt7XG4gICAgICAgICAgICB3M2NQYXJhbTogJ3czY1BhcmFtJyxcbiAgICAgICAgICB9XSxcbiAgICAgICAgfVxuICAgICAgfTtcblxuICAgICAgY29uc3Qge3N0YXR1cywgdmFsdWUsIHNlc3Npb25JZH0gPSAoYXdhaXQgYXhpb3MucG9zdChiYXNlVXJsLCBjb21iaW5lZENhcHMpKS5kYXRhO1xuICAgICAgc2hvdWxkLm5vdC5leGlzdChzdGF0dXMpOyAvLyBJZiBpdCdzIGEgVzNDIHNlc3Npb24sIHNob3VsZCBub3QgcmVzcG9uZCB3aXRoICdzdGF0dXMnXG4gICAgICBzaG91bGQubm90LmV4aXN0KHNlc3Npb25JZCk7XG4gICAgICB2YWx1ZS5zZXNzaW9uSWQuc2hvdWxkLmV4aXN0O1xuICAgICAgdmFsdWUuY2FwYWJpbGl0aWVzLnNob3VsZC5kZWVwLmVxdWFsKHtcbiAgICAgICAgLi4uY2FwcyxcbiAgICAgICAgdzNjUGFyYW06ICd3M2NQYXJhbScsXG4gICAgICB9KTtcblxuICAgICAgLy8gRW5kIHNlc3Npb25cbiAgICAgIGF3YWl0IGF4aW9zLmRlbGV0ZShgJHtiYXNlVXJsfS8ke3ZhbHVlLnNlc3Npb25JZH1gKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgYWNjZXB0IGEgY29tYm8gb2YgVzNDIGFuZCBKU09OV1AgYW5kIGlmIEpTT05XUCBoYXMgZXh0cmFuZW91cyBrZXlzLCB0aGV5IHNob3VsZCBiZSBtZXJnZWQgaW50byBXM0MgY2FwYWJpbGl0aWVzJywgYXN5bmMgZnVuY3Rpb24gKCkge1xuICAgICAgY29uc3QgY29tYmluZWRDYXBzID0ge1xuICAgICAgICAnZGVzaXJlZENhcGFiaWxpdGllcyc6IHtcbiAgICAgICAgICAuLi5jYXBzLFxuICAgICAgICAgIGF1dG9tYXRpb25OYW1lOiAnRmFrZScsXG4gICAgICAgICAgYW5vdGhlclBhcmFtOiAnSGVsbG8nLFxuICAgICAgICB9LFxuICAgICAgICAnY2FwYWJpbGl0aWVzJzoge1xuICAgICAgICAgICdhbHdheXNNYXRjaCc6IHsuLi5jYXBzfSxcbiAgICAgICAgICAnZmlyc3RNYXRjaCc6IFt7XG4gICAgICAgICAgICB3M2NQYXJhbTogJ3czY1BhcmFtJyxcbiAgICAgICAgICB9XSxcbiAgICAgICAgfVxuICAgICAgfTtcblxuICAgICAgY29uc3Qge3Nlc3Npb25JZCwgc3RhdHVzLCB2YWx1ZX0gPSAoYXdhaXQgYXhpb3MucG9zdChiYXNlVXJsLCBjb21iaW5lZENhcHMpKS5kYXRhO1xuICAgICAgc2hvdWxkLm5vdC5leGlzdChzZXNzaW9uSWQpO1xuICAgICAgc2hvdWxkLm5vdC5leGlzdChzdGF0dXMpO1xuICAgICAgdmFsdWUuc2Vzc2lvbklkLnNob3VsZC5leGlzdDtcbiAgICAgIHZhbHVlLmNhcGFiaWxpdGllcy5zaG91bGQuZGVlcC5lcXVhbCh7XG4gICAgICAgIC4uLmNhcHMsXG4gICAgICAgIGF1dG9tYXRpb25OYW1lOiAnRmFrZScsXG4gICAgICAgIGFub3RoZXJQYXJhbTogJ0hlbGxvJyxcbiAgICAgICAgdzNjUGFyYW06ICd3M2NQYXJhbScsXG4gICAgICB9KTtcblxuICAgICAgLy8gRW5kIHNlc3Npb25cbiAgICAgIGF3YWl0IGF4aW9zLmRlbGV0ZShgJHtiYXNlVXJsfS8ke3ZhbHVlLnNlc3Npb25JZH1gKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgcmVqZWN0IGJhZCBXM0MgY2FwYWJpbGl0aWVzIHdpdGggYSBCYWRQYXJhbWV0ZXJzRXJyb3IgKDQwMCknLCBhc3luYyBmdW5jdGlvbiAoKSB7XG4gICAgICBjb25zdCB3M2NDYXBzID0ge1xuICAgICAgICBjYXBhYmlsaXRpZXM6IHtcbiAgICAgICAgICBhbHdheXNNYXRjaDoge1xuICAgICAgICAgICAgLi4uY2FwcyxcbiAgICAgICAgICAgIGF1dG9tYXRpb25OYW1lOiAnQmFkQXV0b21hdGlvbk5hbWUnLFxuICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICB9O1xuICAgICAgYXdhaXQgYXhpb3MucG9zdChiYXNlVXJsLCB3M2NDYXBzKS5zaG91bGQuZXZlbnR1YWxseS5iZS5yZWplY3RlZFdpdGgoLzQwMC8pO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBhY2NlcHQgY2FwYWJpbGl0aWVzIHRoYXQgYXJlIHByb3ZpZGVkIGluIHRoZSBmaXJzdE1hdGNoIGFycmF5JywgYXN5bmMgZnVuY3Rpb24gKCkge1xuICAgICAgY29uc3QgdzNjQ2FwcyA9IHtcbiAgICAgICAgY2FwYWJpbGl0aWVzOiB7XG4gICAgICAgICAgYWx3YXlzTWF0Y2g6IHt9LFxuICAgICAgICAgIGZpcnN0TWF0Y2g6IFt7fSwge1xuICAgICAgICAgICAgLi4uY2Fwc1xuICAgICAgICAgIH1dLFxuICAgICAgICB9LFxuICAgICAgfTtcbiAgICAgIGNvbnN0IHt2YWx1ZSwgc2Vzc2lvbklkLCBzdGF0dXN9ID0gKGF3YWl0IGF4aW9zLnBvc3QoYmFzZVVybCwgdzNjQ2FwcykpLmRhdGE7XG4gICAgICBzaG91bGQubm90LmV4aXN0KHN0YXR1cyk7XG4gICAgICBzaG91bGQubm90LmV4aXN0KHNlc3Npb25JZCk7XG4gICAgICB2YWx1ZS5jYXBhYmlsaXRpZXMuc2hvdWxkLmRlZXAuZXF1YWwoY2Fwcyk7XG5cbiAgICAgIC8vIEVuZCBzZXNzaW9uXG4gICAgICBhd2FpdCBheGlvcy5kZWxldGUoYCR7YmFzZVVybH0vJHt2YWx1ZS5zZXNzaW9uSWR9YCk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGZhbGwgYmFjayB0byBNSlNPTldQIGlmIHczYyBjYXBzIGFyZSBpbnZhbGlkJywgYXN5bmMgZnVuY3Rpb24gKCkge1xuICAgICAgY29uc3QgY29tYmluZWRDYXBzID0ge1xuICAgICAgICBkZXNpcmVkQ2FwYWJpbGl0aWVzOiB7XG4gICAgICAgICAgLi4uY2FwcyxcbiAgICAgICAgfSxcbiAgICAgICAgY2FwYWJpbGl0aWVzOiB7XG4gICAgICAgICAgYWx3YXlzTWF0Y2g6IHt9LFxuICAgICAgICAgIGZpcnN0TWF0Y2g6IFt7fSwge1xuICAgICAgICAgICAgLi4uY2FwcyxcbiAgICAgICAgICAgIHBsYXRmb3JtTmFtZTogbnVsbCxcbiAgICAgICAgICB9XSxcbiAgICAgICAgfSxcbiAgICAgIH07XG4gICAgICBjb25zdCB7dmFsdWUsIHNlc3Npb25JZCwgc3RhdHVzfSA9IChhd2FpdCBheGlvcy5wb3N0KGJhc2VVcmwsIGNvbWJpbmVkQ2FwcykpLmRhdGE7XG4gICAgICBzdGF0dXMuc2hvdWxkLmV4aXN0O1xuICAgICAgc2Vzc2lvbklkLnNob3VsZC5leGlzdDtcbiAgICAgIHZhbHVlLnNob3VsZC5kZWVwLmVxdWFsKGNhcHMpO1xuXG4gICAgICAvLyBFbmQgc2Vzc2lvblxuICAgICAgYXdhaXQgYXhpb3MuZGVsZXRlKGAke2Jhc2VVcmx9LyR7c2Vzc2lvbklkfWApO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBmYWxsIGJhY2sgdG8gTUpTT05XUCBpZiBJbm5lciBEcml2ZXIgaXMgbm90IHJlYWR5IGZvciBXM0MnLCBhc3luYyBmdW5jdGlvbiAoKSB7XG4gICAgICBjb25zdCBjb21iaW5lZENhcHMgPSB7XG4gICAgICAgIGRlc2lyZWRDYXBhYmlsaXRpZXM6IHtcbiAgICAgICAgICAuLi5jYXBzLFxuICAgICAgICB9LFxuICAgICAgICBjYXBhYmlsaXRpZXM6IHtcbiAgICAgICAgICBhbHdheXNNYXRjaDoge1xuICAgICAgICAgICAgLi4uY2FwcyxcbiAgICAgICAgICAgIGRldmljZU5hbWU6IG51bGwsXG4gICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgIH07XG4gICAgICBjb25zdCBjcmVhdGVTZXNzaW9uU3R1YiA9IHNpbm9uLnN0dWIoRmFrZURyaXZlci5wcm90b3R5cGUsICdjcmVhdGVTZXNzaW9uJykuY2FsbHNGYWtlKGFzeW5jIGZ1bmN0aW9uIChqc29ud3BDYXBzKSB7XG4gICAgICAgIGNvbnN0IHJlcyA9IGF3YWl0IEJhc2VEcml2ZXIucHJvdG90eXBlLmNyZWF0ZVNlc3Npb24uY2FsbCh0aGlzLCBqc29ud3BDYXBzKTtcbiAgICAgICAgdGhpcy5wcm90b2NvbC5zaG91bGQuZXF1YWwoJ01KU09OV1AnKTtcbiAgICAgICAgcmV0dXJuIHJlcztcbiAgICAgIH0pO1xuXG4gICAgICBjb25zdCB7dmFsdWUsIHNlc3Npb25JZCwgc3RhdHVzfSA9IChhd2FpdCBheGlvcy5wb3N0KGJhc2VVcmwsIGNvbWJpbmVkQ2FwcykpLmRhdGE7XG4gICAgICBzdGF0dXMuc2hvdWxkLmV4aXN0O1xuICAgICAgc2Vzc2lvbklkLnNob3VsZC5leGlzdDtcbiAgICAgIHZhbHVlLnNob3VsZC5kZWVwLmVxdWFsKGNhcHMpO1xuXG4gICAgICBjcmVhdGVTZXNzaW9uU3R1Yi5yZXN0b3JlKCk7XG5cbiAgICAgIC8vIEVuZCBzZXNzaW9uXG4gICAgICBhd2FpdCBheGlvcy5kZWxldGUoYCR7YmFzZVVybH0vJHtzZXNzaW9uSWR9YCk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBjb25jdXJyZW50IE1KU09OV1AgYW5kIFczQyBzZXNzaW9ucycsIGFzeW5jIGZ1bmN0aW9uICgpIHtcbiAgICAgIGNvbnN0IGNvbWJpbmVkQ2FwcyA9IHtcbiAgICAgICAgZGVzaXJlZENhcGFiaWxpdGllczoge1xuICAgICAgICAgIC4uLmNhcHMsXG4gICAgICAgIH0sXG4gICAgICAgIGNhcGFiaWxpdGllczoge1xuICAgICAgICAgIGFsd2F5c01hdGNoOiB7XG4gICAgICAgICAgICAuLi5jYXBzLFxuICAgICAgICAgIH0sXG4gICAgICAgICAgZmlyc3RNYXRjaDogW10sXG4gICAgICAgIH0sXG4gICAgICB9O1xuXG4gICAgICAvLyBIYXZlIGFuIE1KU09OV1AgYW5kIFczQyBzZXNzaW9uIHJ1bm5pbmcgY29uY3VycmVudGx5XG4gICAgICBjb25zdCB7c2Vzc2lvbklkOiBtanNvbndwU2Vzc0lkLCB2YWx1ZTogbWpzb253cFZhbHVlLCBzdGF0dXN9ID0gKGF3YWl0IGF4aW9zLnBvc3QoYmFzZVVybCwgXy5vbWl0KGNvbWJpbmVkQ2FwcywgJ2NhcGFiaWxpdGllcycpKSkuZGF0YTtcbiAgICAgIHN0YXR1cy5zaG91bGQuZXhpc3Q7XG4gICAgICBtanNvbndwVmFsdWUuc2hvdWxkLmVxbChjYXBzKTtcbiAgICAgIG1qc29ud3BTZXNzSWQuc2hvdWxkLmV4aXN0O1xuXG4gICAgICBjb25zdCB7dmFsdWV9ID0gKGF3YWl0IGF4aW9zLnBvc3QoYmFzZVVybCwgXy5vbWl0KGNvbWJpbmVkQ2FwcywgJ2Rlc2lyZWRDYXBhYmlsaXRpZXMnKSkpLmRhdGE7XG4gICAgICBjb25zdCB3M2NTZXNzSWQgPSB2YWx1ZS5zZXNzaW9uSWQ7XG4gICAgICB3M2NTZXNzSWQuc2hvdWxkLmV4aXN0O1xuICAgICAgdmFsdWUuY2FwYWJpbGl0aWVzLnNob3VsZC5lcWwoY2Fwcyk7XG5cbiAgICAgIC8vIFRlc3QgdGhhdCBib3RoIHJldHVybiB0aGUgcHJvcGVyIHBheWxvYWQgYmFzZWQgb24gdGhlaXIgcHJvdG9jb2xcbiAgICAgIGNvbnN0IG1qc29ud3BQYXlsb2FkID0gKGF3YWl0IGF4aW9zLmdldChgJHtiYXNlVXJsfS8ke21qc29ud3BTZXNzSWR9YCkpLmRhdGE7XG4gICAgICBtanNvbndwUGF5bG9hZC5zZXNzaW9uSWQuc2hvdWxkLmV4aXN0O1xuICAgICAgbWpzb253cFBheWxvYWQuc3RhdHVzLnNob3VsZC5leGlzdDtcbiAgICAgIG1qc29ud3BQYXlsb2FkLnZhbHVlLnNob3VsZC5lcWwoY2Fwcyk7XG5cbiAgICAgIGNvbnN0IHczY1BheWxvYWQgPSAoYXdhaXQgYXhpb3MuZ2V0KGAke2Jhc2VVcmx9LyR7dzNjU2Vzc0lkfWApKS5kYXRhO1xuICAgICAgc2hvdWxkLm5vdC5leGlzdCh3M2NQYXlsb2FkLnNlc3Npb25JZCk7XG4gICAgICBzaG91bGQubm90LmV4aXN0KHczY1BheWxvYWQuc3RhdHVzKTtcbiAgICAgIHczY1BheWxvYWQudmFsdWUuc2hvdWxkLmVxbChjYXBzKTtcblxuICAgICAgLy8gRW5kIHNlc3Npb25zXG4gICAgICBhd2FpdCBheGlvcy5kZWxldGUoYCR7YmFzZVVybH0vJHttanNvbndwU2Vzc0lkfWApO1xuICAgICAgYXdhaXQgYXhpb3MuZGVsZXRlKGAke2Jhc2VVcmx9LyR7dzNjU2Vzc0lkfWApO1xuICAgIH0pO1xuICB9KTtcbn0pO1xuXG5kZXNjcmliZSgnTG9nc2luaycsIGZ1bmN0aW9uICgpIHtcbiAgbGV0IHNlcnZlciA9IG51bGw7XG4gIGxldCBsb2dzID0gW107XG4gIGxldCBsb2dIYW5kbGVyID0gZnVuY3Rpb24gKGxldmVsLCBtZXNzYWdlKSB7XG4gICAgbG9ncy5wdXNoKFtsZXZlbCwgbWVzc2FnZV0pO1xuICB9O1xuICBsZXQgYXJncyA9IHtcbiAgICBwb3J0OiBURVNUX1BPUlQsXG4gICAgaG9zdDogVEVTVF9IT1NULFxuICAgIGxvZ0hhbmRsZXIsXG4gIH07XG5cbiAgYmVmb3JlKGFzeW5jIGZ1bmN0aW9uICgpIHtcbiAgICBzZXJ2ZXIgPSBhd2FpdCBhcHBpdW1TZXJ2ZXIoYXJncyk7XG4gIH0pO1xuXG4gIGFmdGVyKGFzeW5jIGZ1bmN0aW9uICgpIHtcbiAgICBhd2FpdCBzZXJ2ZXIuY2xvc2UoKTtcbiAgfSk7XG5cbiAgaXQoJ3Nob3VsZCBzZW5kIGxvZ3MgdG8gYSBsb2dIYW5kbGVyIHBhc3NlZCBpbiBieSBhIHBhcmVudCBwYWNrYWdlJywgZnVuY3Rpb24gKCkge1xuICAgIGxvZ3MubGVuZ3RoLnNob3VsZC5iZS5hYm92ZSgxKTtcbiAgICBsZXQgd2VsY29tZUluZGV4ID0gbG9nc1swXVsxXS5pbmNsdWRlcygndmVyc2lvbnMgb2Ygbm9kZScpID8gMSA6IDA7XG4gICAgbG9nc1t3ZWxjb21lSW5kZXhdLmxlbmd0aC5zaG91bGQuZXF1YWwoMik7XG4gICAgbG9nc1t3ZWxjb21lSW5kZXhdWzFdLnNob3VsZC5pbmNsdWRlKCdXZWxjb21lIHRvIEFwcGl1bScpO1xuICB9KTtcbn0pO1xuIl0sImZpbGUiOiJ0ZXN0L2RyaXZlci1lMmUtc3BlY3MuanMiLCJzb3VyY2VSb290IjoiLi4vLi4ifQ==
